@using MadrinHotelCRM.DTO.DTOModels
@using System.ComponentModel.DataAnnotations
@using System.Reflection
@using MadrinHotelCRM.Entities.Models

@model List<OdaDTO>
<!--oda durum enumını string olarak gösterilmesi için oluşturulmuş function.-->
@functions {
    string GetDisplayName(Enum enumValue)
    {
        var member = enumValue.GetType()
            .GetMember(enumValue.ToString())
            .FirstOrDefault();

        var displayAttr = member?.GetCustomAttribute<DisplayAttribute>();
        return displayAttr?.Name ?? enumValue.ToString();
    }
}

<h3 class="mb-4"> Oda Yönetimi</h3>

<!-- ODA EKLEME FORMU -->
<form id="odaEkleForm">
    <div class="row g-2">
        <div class="col-md-4">
            <input name="OdaNumarasi" class="form-control" placeholder="Oda No" required />
        </div>
        <div class="col-md-4">
            <input name="Durum" class="form-control" placeholder="Durum (Boş / Dolu)" required />
        </div>
        <div class="col-md-4">
            <select name="OdaTipiId" class="form-select" required>
                <option disabled selected>Oda Tipi Seç</option>
                <option value="1">Standart</option>
                <option value="2">Deluxe</option>
                <option value="3">Süit</option>
            </select>
        </div>
    </div>
    <button type="submit" class="btn btn-success mt-3">+ Oda Ekle</button>

</form>

<hr class="my-4" />

<!-- ODA TABLOSU -->
<table class="table table-bordered table-striped">
    <thead class="table-light">
        <tr>
            <th>ID</th>
            <th>Oda No</th>
            <th>Durum</th>
            <th>Oda Tipi</th>
        </tr>
    </thead>
    <tbody>
        @if (Model != null && Model.Any())
        {
            foreach (var oda in Model)
            {
                <tr>
                    <td>@oda.OdaId</td>
                    <td>@oda.OdaNumarasi</td>
                    <td>@GetDisplayName(oda.Durum)</td> <!--enumdaki display name görünmesi için.-->
                    <td>@oda.OdaTipi?.OdaTurAd</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteOda(@oda.OdaId)">Sil</button>
                    </td>
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="4" class="text-center">Henüz oda bulunmuyor.</td>
            </tr>
        }
    </tbody>
</table>

<script>
    $("#odaEkleForm").submit(function (e) {
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "/AdminPanel/OdaEkle",
            data: $(this).serialize(),
            success: function () {
                loadPanel("GetAllOdalar");
            },
            error: function () {
                alert("Oda eklenirken bir hata oluştu.");
            }
        });
    });

    function deleteOda(id) {
        if (confirm("Bu odayı silmek istediğinize emin misiniz?")) {
            $.ajax({
                type: "POST",
                url: "/AdminPanel/OdaSil/" + id,
                success: function () {
                    loadPanel("GetAllOdalar");
                },
                error: function () {
                    alert("Oda silinemedi!");
                }
            });
        }
    }
</script>
